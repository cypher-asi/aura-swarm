#!/bin/bash
# Configuration for aura-swarm infrastructure deployment
# Source this file before running deploy scripts

#------------------------------------------------------------------------------
# AWS Configuration
#------------------------------------------------------------------------------
export AWS_REGION="${AWS_REGION:-us-east-2}"
export AWS_PROFILE="${AWS_PROFILE:-default}"

#------------------------------------------------------------------------------
# Project Configuration
#------------------------------------------------------------------------------
export PROJECT_NAME="${PROJECT_NAME:-aura-swarm}"
export ENVIRONMENT="${ENVIRONMENT:-dev}"

# Resource naming prefix (PROJECT_NAME-ENVIRONMENT)
export RESOURCE_PREFIX="${PROJECT_NAME}-${ENVIRONMENT}"

#------------------------------------------------------------------------------
# EKS Configuration
#------------------------------------------------------------------------------
export EKS_VERSION="${EKS_VERSION:-1.31}"
export EKS_CLUSTER_NAME="${RESOURCE_PREFIX}-cluster"

# Node group configuration
# Using m5.2xlarge for nested virtualization support (Kata/Firecracker)
export NODE_INSTANCE_TYPE="${NODE_INSTANCE_TYPE:-m5.2xlarge}"
export NODE_DESIRED_COUNT="${NODE_DESIRED_COUNT:-2}"
export NODE_MIN_COUNT="${NODE_MIN_COUNT:-1}"
export NODE_MAX_COUNT="${NODE_MAX_COUNT:-5}"

#------------------------------------------------------------------------------
# Networking Configuration (from spec 08-networking.md)
#------------------------------------------------------------------------------
export VPC_CIDR="${VPC_CIDR:-10.0.0.0/16}"
export PUBLIC_SUBNET_CIDR="${PUBLIC_SUBNET_CIDR:-10.0.1.0/24}"
export PRIVATE_SUBNET_CIDR="${PRIVATE_SUBNET_CIDR:-10.0.2.0/24}"
export AGENT_SUBNET_CIDR="${AGENT_SUBNET_CIDR:-10.0.3.0/24}"
export STORAGE_SUBNET_CIDR="${STORAGE_SUBNET_CIDR:-10.0.4.0/24}"

#------------------------------------------------------------------------------
# ECR Repositories
#------------------------------------------------------------------------------
export ECR_REPO_GATEWAY="${RESOURCE_PREFIX}-gateway"
export ECR_REPO_CONTROL="${RESOURCE_PREFIX}-control"
export ECR_REPO_SCHEDULER="${RESOURCE_PREFIX}-scheduler"

#------------------------------------------------------------------------------
# Kubernetes Namespaces
#------------------------------------------------------------------------------
export K8S_NAMESPACE_SYSTEM="swarm-system"
export K8S_NAMESPACE_AGENTS="swarm-agents"

#------------------------------------------------------------------------------
# Container Images
#------------------------------------------------------------------------------
export IMAGE_TAG="${IMAGE_TAG:-latest}"

#------------------------------------------------------------------------------
# Agent Isolation
#------------------------------------------------------------------------------
# "container" - Standard container isolation (runc), works on any K8s cluster
# "microvm"   - MicroVM isolation (Kata Containers with Firecracker), requires
#               Kata runtime installed on nodes with label katacontainers.io/kata-runtime=true
export DEFAULT_ISOLATION="${DEFAULT_ISOLATION:-container}"

#------------------------------------------------------------------------------
# Terraform Configuration
#------------------------------------------------------------------------------
export TF_STATE_BUCKET="${RESOURCE_PREFIX}-terraform-state"
export TF_STATE_REGION="${AWS_REGION}"
export TF_STATE_KEY="terraform.tfstate"

#------------------------------------------------------------------------------
# Script Directory (auto-detected)
#------------------------------------------------------------------------------
export DEPLOY_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export PROJECT_ROOT="$(cd "${DEPLOY_DIR}/.." && pwd)"
